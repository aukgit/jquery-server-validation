(function(n,t,i,r){"use strict";if(typeof jQuery=="undefined")throw new Error("serverValidate requires jQuery");if(typeof jQuery.validator=="undefined")throw new Error("serverValidate requires jQuery validation plugin & jquery.validate.unobtrusive plugin.");var f="serverValidate",o,u=null,c=[],s={crossDomain:!0,multipleRequests:!0,checkValidationBeforeSendingRequest:!0,dontSendSameRequestTwice:!0,disableInputOnValidation:!0,focusPersistIfNotValid:!0,hideOnValidation:!1,submitMethod:"post",eventsNameSpace:"jq.validate.",$directContainer:[],eventsObject:null,url:"",formSelector:"",$formElement:[],triggerValidationBeforeFormSubmit:!0,$submitButton:[],messages:{requesting:"Requesting data..."},selectors:{divContainer:".form-row",validatorContainer:".validator-container",validator:".validator",additionalFields:"[name=__RequestVerificationToken]"},attributes:{url:"data-url",isValidate:"data-is-validate",submitMethod:"data-submit-method"},icons:{invalid:"validation-icon-invalid fa fa-times",valid:"validation-icon-valid fa fa-check",spinner:"validation-icon-spinner fa fa-refresh fa-spin-custom",error:"validation-icon-error fa fa-exclamation-circle"},iconsIdPrefixes:{invalid:"invalid-mark-",valid:"valid-mark-",spinner:"validation-spinner-",error:"validation-error-"},response:{message:"Field is valid.",isValid:!0,isError:!1,errorCode:null,errorMessage:null},events:{iconCreated:function(){},sameRequestTwice:function(){},beforeSendingRequest:function(){},responseReceived:function(){},responseProcessed:function(){},invalidBefore:function(){},invalidAfter:function(){},validBefore:function(){},validAfter:function(){},onError:function(){}}},h=function(n,t,i,r){this.$element=n;this._name=f;this.$input=t;this.settings=i;this.additionalFields=r;this.events.plugin=this;this.events.names.plugin=this;this.init(n)},l=function(t,i){var e=[],u=[],s=t===r||t===null||t.length===0,f;if(u=s?n(i):t.find(i),u.length>0)for(f=0;f<u.length;f++){var o=n(u[f]),h=o.attr("name"),c=o.attr("value"),l={name:h,value:c};e.push(l)}return e},e=function(n,t,i){var u=n.attr(t);return u!==r&&u!==null?u==="true"?!0:u==="false"?!1:u:i},a=function(n,t){for(var i,u=[{setting:"crossDomain",attr:"data-cross-domain"},{setting:"url",attr:"data-url"},{setting:"multipleRequests",attr:"data-is-multiple-requests"},{setting:"hideOnValidation",attr:"data-hide-on-success"},{setting:"disableInputOnValidation",attr:"data-disable-on-success"},{setting:"focusPersistIfNotValid",attr:"data-focus-on-fail"},{setting:"eventsObject",attr:"data-events-object"},{setting:"dontSendSameRequestTwice",attr:"data-dont-send-same-twice"},{setting:"focusPersistIfNotValid",attr:"data-focus-on-fail"},{setting:"formSelector",attr:"data-form-selector"},{setting:"triggerValidationBeforeFormSubmit",attr:"data-trigger-validation-before-form-submit"},{setting:"focusPersistIfNotValid",attr:"data-focus-on-fail"},{setting:"submitMethod",attr:"data-submit-method"}],r=0;r<u.length;r++)i=u[r],t[i.setting]=e(n,i.attr,t[i.setting]);return t.selectors.additionalFields=e(n,"data-additional-selectors",t.selectors.additionalFields),t.messages.requesting=e(n,"data-requesting-label",t.messages.requesting),t};n.extend(h.prototype,{isDebugging:!1,additionalFields:[],$element:null,$input:null,isEmpty:function(n){return n===null||n===r||n.length===0},init:function(n){this.isValidForProcessing(n)&&(this.events.bindAllEvents(this),this.processDiv(this,n))},getSettings:function(){return this.settings},isMultipleRequestAllowed:function(){return this.getSettings().multipleRequests},isDisableInputOnValidation:function(){return this.getSettings().disableInputOnValidation},isInputValidationRequirestoSendRequest:function(){return this.getSettings().checkValidationBeforeSendingRequest},dontSendSameRequestTwice:function(){return this.getSettings().dontSendSameRequestTwice},events:{names:{serverProcessStart:"serverProcessStart",serverProcessSucceeded:"serverProcessSucceeded",serverProcessFailed:"serverProcessFailed",serverProcessRunning:"serverProcessRunning",serverProcessReturnedAlways:"serverProcessReturnedAlways",serverAllRequestComplete:"serverAllRequestComplete",hideIcons:"hideIcons",createIcon:"createIcon",showingSpinnerIcon:"showingSpinnerIcon",typingStart:"typingStart",getName:function(n,t){var i=n.getSettings(),r=i.eventsNameSpace,u=n.getInputNameOrId(n.$input);return r+u+"."+t}},getEventsCommonAttributes:function(t,i,r){var o=t.$element,e=t.$input,s=t.getSettings(),h=t.getInputNameOrId(t.$input),f=this.names.getName(t,i),u=this[f];return t.isEmpty(u)&&(u={id:h,name:e.attr("name"),$input:e,$divContainer:o,eventName:i,finalEventName:f,plugin:t,settings:s},u=n.extend({},u,r),this[f]=u),u},bindAllEvents:function(n){var w=n.isDebugging,t=this.names,c=t.getName(n,t.serverProcessStart),l=t.getName(n,t.serverProcessSucceeded),a=t.getName(n,t.serverProcessFailed),v=t.getName(n,t.serverProcessReturnedAlways),y=t.getName(n,t.serverAllRequestComplete),k=f+".ajaxRequest",r=n.$element,i=n.$input,u=n.getUrl(),b=n.sendRequest,d=n.getSettings(),e,p=this.getEventsCommonAttributes(n,t.serverProcessStart,{url:u}),o,s,h;i.on(c,p,function(){var t=n.concatAdditionalFields(i);b(n,r,i,u,t)});r.on(c,p,function(){});o=this.getEventsCommonAttributes(n,t.serverProcessSucceeded,{url:u});i.on(l,o,function(t,u){e=u;w&&console.log(u);t.data.response=u;n.hideAllIcons(r);n.markAsProcessing(r,!1);n.processResponse(i,u);r.attr("data-icon-added","true");n.hideSpinner(i)});r.on(l,o,function(n){n.data.response=e});s=this.getEventsCommonAttributes(n,t.serverProcessFailed,{url:u});i.on(a,s,function(t,f,e,o){n.hideAllIcons(r);n.hideSpinner(i);n.errorProcess(r,i,f,e,o,u)});r.on(a,s,function(){});h=this.getEventsCommonAttributes(n,t.serverProcessReturnedAlways,{url:u});i.on(v,h,function(t){t.data.response=e;n.markAsProcessing(r,!1);n.hideSpinner(i)});i.on(y,function(){console.log(y);n.hideSpinner(i)});r.on(v,h,function(){})}},getAttributes:function(){return this.getSettings().attributes},getEvents:function(){return this.getSettings().events},getIcons:function(){return this.getSettings().icons},getIdPrefixes:function(){return this.getSettings().iconsIdPrefixes},getSelectors:function(){return this.getSettings().selectors},getMessages:function(){return this.getSettings().messages},isValidForProcessing:function(n){var t=this.getAttributes();return n.attr(t.isValidate)==="true"},getInput:function(){if(this.isEmpty(this.$input)){var n=this.$element;this.$input=n.find("input")}return this.$input},getUrl:function(){if(this.isEmpty(this._url)){var n=this.getAttributes(),t=this.getInput();this._url=t.attr(n.url)}return this._url},processDiv:function(n,t){var i=this.getInput(t),r=this.getUrl();this.inputProcessWithBlurEvent(n,t,i,r)},test:function(){this.showSpinner($input)},setCurrentTextForNexttimeChecking:function(n){n.attr("data-previous-submit",n.val())},isPreviousRequestIsSame:function(n,t,i){var u=t.attr("data-previous-submit"),r=u===t.val(),e=this.getSettings(),f=e.events;return this.isDebugging&&console.log("Request is same : "+r),r&&(this.isEmpty(f.sameRequestTwice)||f.sameRequestTwice(n,t,i,u)),r},hideAllIcons:function(n){var t=this,i=t.getInput();n.removeAttr("data-icon-added");t.hideInvalidIcon(i);t.hideSpinner(i);t.hideErrorIcon(i);t.hideErrorIcon(i);t.hideValidIcon(i)},inputProcessWithBlurEvent:function(n,t,i,r){var u=!0,e=n.events.names,o=e.getName(n,e.serverProcessStart),s=function(){u===!0&&(n.hideAllIcons(t),u=!1)},h=function(r,f){var e=!n.isInProcessingMode(t)||n.isMultipleRequestAllowed(),c,h;e&&(c=n.dontSendSameRequestTwice()&&!n.isPreviousRequestIsSame(t,i,f),e=c||!n.dontSendSameRequestTwice(),e&&(h=n.isInputValidationRequirestoSendRequest(),e=h&&i.valid()||!h,e&&(s(),u=!0,i.trigger(o)),n.getSettings().focusPersistIfNotValid&&n.focusIfnotValid(i)))},f;i.on("keypress",function(t,i){n.isEmpty(f)||clearTimeout(f);n.isEmpty(i)&&(i=750);f=setTimeout(function(){h(t,r)},i)})},focusIfnotValid:function(n,t){if(t===!0){n.focus();return}n.valid()===!1&&n.focus()},concatAdditionalFields:function(n){var t=this.additionalFields.slice(),i={name:n.attr("name"),value:n.val()};return t.push(i),t},getSubmitMethod:function(){return this.getSettings().submitMethod},abortPreviousAjaxRequest:function(n){if(!this.isEmpty(this.ajaxRequest)){var t=this.$element;this.ajaxRequest.abort();this.hideAllIcons(t);this.showSpinner(n);t.attr("data-icon-added","true")}},sendRequest:function(t,i,r,u,f){var l=t.getSubmitMethod(r),o=t.getSettings(),s=o.crossDomain,h=o.events;t.isEmpty(h.beforeSendingRequest)||h.beforeSendingRequest(i,r,u,f);t.abortPreviousAjaxRequest(r);t.markAsProcessing(i,!0);t.setCurrentTextForNexttimeChecking(r);t.hideAllIcons(i);var e=t.events.names,a=e.getName(t,e.serverProcessSucceeded),v=e.getName(t,e.serverProcessFailed),y=e.getName(t,e.serverProcessReturnedAlways),c={method:l,url:u,data:f,crossDomain:s,dataType:"json"};s==!0&&(c.dataType="jsonp");t.ajaxRequest=n.ajax(c).done(function(n){r.trigger(a,[n])}).fail(function(n,t,i){r.trigger(v,[n,t,i])}).always(function(){r.trigger(y)})},errorProcess:function(n,t,i,r,u,f){var e=i.status,o=this.getSettings(),s=o.events,h="";if(e===0&&(e=404,r="Requested url doesn't lead to a valid request."),h="Code "+e+" : "+r,this.showErrorIcon(t,h),o.focusPersistIfNotValid&&this.focusIfnotValid(t,!0),!this.isEmpty(s.onError))s.onError(n,t,i,r,u,f)},markAsProcessing:function(n,t){this.isDebugging&&console.log("Making: "+t);n.attr("data-is-processing",t)},isInProcessingMode:function(n){var t=n.attr("data-is-processing");return this.isDebugging&&console.log("is Processing: "+t),t==="true"},getInputNameOrId:function(n){var t=n.attr("id");return this.isEmpty(t)&&(t=n.attr("name")),t},setMessageOnIcons:function(n,t){var i=n.find("a").attr("title",t).attr("data-original-title",t).find("span");i.attr("title",t).attr("data-display",t)},createIcons:function(t,i,r,u){var h=this.getInputNameOrId(t),c=this.getValidator(),l=this.$element,a=this.getSettings(),o=a.events,s=this.getWrapperPrefix(),f=u+h,v="<div class='validation-icon-wrapper' id='"+s+f+"'><a data-toggle='tooltip' id='"+f+"'title='"+r+"' data-original-title='"+r+"' class='tooltip-show'><span data-display='"+r+"' class='"+i+"' title='"+r+"'><\/span><\/a><\/div>",e;return c.append(v),e=n.byId(s+f),n.byId(f).tooltip(),this.isEmpty(o.iconCreated)||o.iconCreated(l,t,e),e},getWrapperPrefix:function(){return"wrapper-"},getValidator:function(){if(this.isEmpty(this.$validator)){var n=this.getSelectors();this.$validator=this.$element.find(n.validator)}return this.$validator},getCachedIcon:function(n,t){var r=this.getIdPrefixes(),s=this.getWrapperPrefix()+t+this.getInputNameOrId(n),e="$"+s,u=this[e];if(this.isEmpty(u)){var h=this.getMessages(),o="",f=this.getIcons(),i="";t===r.spinner?(i=f.spinner,o=h.requesting):t===r.valid?i=f.valid:t===r.invalid?i=f.invalid:t===r.error&&(i=f.error);u=this.createIcons(n,i,o,t);this[e]=u}return u},getInvalidIcon:function(n){if(this.isEmpty(this.$invalidMarkIcon)){var t=this.getIdPrefixes();this.$invalidMarkIcon=this.getCachedIcon(n,t.invalid)}return this.$invalidMarkIcon},getValidIcon:function(n){if(this.isEmpty(this.$validMarkIcon)){var t=this.getIdPrefixes();this.$validMarkIcon=this.getCachedIcon(n,t.valid)}return this.$validMarkIcon},getSpinner:function(n){if(this.isEmpty(this.$spinner)){var t=this.getIdPrefixes();this.$spinner=this.getCachedIcon(n,t.spinner)}return this.$spinner},getErrorIcon:function(n){if(this.isEmpty(this.$errorIcon)){var t=this.getIdPrefixes();this.$errorIcon=this.getCachedIcon(n,t.error)}return this.$errorIcon},showErrorIcon:function(n,t){var i=this.getErrorIcon(n);this.setMessageOnIcons(i,t);this.animateOn(i)},showSpinner:function(n){var t=this.getSpinner(n);this.animateOn(t)},showInvalidIcon:function(n,t){var i=this.getInvalidIcon(n);this.setMessageOnIcons(i,t);this.animateOn(i)},showValidIcon:function(n,t){var i=this.getValidIcon(n);this.setMessageOnIcons(i,t);this.animateOn(i)},hideValidIcon:function(n){var t=this.getValidIcon(n);this.animateOff(t)},hideErrorIcon:function(n){var t=this.getErrorIcon(n);this.animateOff(t)},hideInvalidIcon:function(n){var t=this.getInvalidIcon(n);this.animateOff(t)},hideSpinner:function(n){var t=this.getSpinner(n);this.animateOff(t)},animateOn:function(n){n.removeClass("hide")},animateOff:function(n){n.addClass("hide")},processResponse:function(t,i){var u=this,f=this.$element,e=this.getSettings(),r=e.events,o;this.isEmpty(r.responseReceived)||r.responseReceived(f,t,i);o=e.response;i=n.extend({},o,i);i.isValid?u.validResponse(t,i):u.inValidResponse(t,i);this.isEmpty(r.responseProcessed)||r.responseProcessed(f,t,i)},validResponse:function(n,t){var e=this.isDisableInputOnValidation(),r=this.getSettings().events,o=this.getSettings(),i=this.$element,u=!0,f=t.message;this.isEmpty(r.validBefore)||r.validBefore(i,n,t);this.showValidIcon(n,t.message);e&&n.attr("disabled","disabled");i.attr("data-server-validated",u).attr("data-message",f);n.attr("data-server-validated",u).attr("data-message",f);n.removeClass("input-validation-error");o.hideOnValidation&&(i.attr("data-is-hidden",u),i.hide("slow"));this.isEmpty(r.validAfter)||r.validAfter(i,n,t)},inValidResponse:function(n,t){var u=this.getSettings(),i=u.events,r=this.$element,f=!1,e=t.message;this.isEmpty(i.invalidBefore)||i.invalidBefore(r,n,t);this.showInvalidIcon(n,t.errorMessage);r.attr("data-server-validated",f).attr("data-message",e);n.attr("data-server-validated",f).attr("data-message",e);n.addClass("input-validation-error");u.focusPersistIfNotValid&&this.focusIfnotValid(n,!0);this.isEmpty(i.invalidAfter)||i.invalidAfter(r,n,t)},isInvalid:function(n){var t=n.getInput();return t.attr("data-server-validated")!=="true"||!t.valid()},sendServerValidationRequestOnlyIfInputInvalidOrNotProcessed:function(n){var i=n.getInput();if(n.isInvalid(n)===!0){var r=n.events,t=r.names,u=t.getName(n,t.serverProcessStart);return i.trigger(u),1}return 0},getEventNameOfServerAlways:function(n){var i=n.events,t=i.names;return t.getName(n,t.serverProcessReturnedAlways)}});n.fn.serverValidate=function(t){var w,tt,g,v,b,ot,k,it,st,ht,e,rt,ct;u=this;var lt=u===r||u===null||u.length===0,d=this,i=n.extend({},s,t),et=i.selectors,at=et.additionalFields,nt;for(d.isValidationInit!==!0&&i.$directContainer.length===0&&(o=d.find(et.divContainer),d.isValidationInit=!0),w=null,tt=function(n){return n===r||n===null||n.length===0||n===""},w=i.$directContainer.length===0?o:i.$directContainer,g=[],v=0;v<w.length;v++)b=n(w[v]),ot=n.extend({},s,t),b.attr("data-is-validate")==="true"&&(k=b.find("input"),it=a(k,ot),nt=l(d,at),c.push(k),st=new h(b,k,it,nt),ht={plugin:st,additionalFields:nt,$divContainer:b,$input:k,options:it},g.push(ht));if(lt===!1&&w.length>0&&(u["plugin."+f]={self:this,attachers:g}),e=i.$formElement,i.triggerValidationBeforeFormSubmit===!0&&(e.length!==0||tt(i.formSelector)||(e=n(i.formSelector)),e.length>0&&tt(i.$submitButton)&&(i.$submitButton=e.find("button"))),rt=i.$submitButton,ct=i.triggerValidationBeforeFormSubmit===!0&&e.length>0,ct&&e.length>0){var y=g,p=0,ut=!1;for(e.removeData("validator").removeData("unobtrusiveValidation"),n.validator.unobtrusive.parse(e),e.submit(function(n){var t,i;if(ut===!1){for(p=0,t=0;t<y.length;t++)i=y[t],p+=i.plugin.sendServerValidationRequestOnlyIfInputInvalidOrNotProcessed(i.plugin);p>0&&(n.preventDefault(),rt.attr("disabled","disabled"))}else ut=!1,this.submit()}),v=0;v<y.length;v++){var ft=y[v].plugin,vt=ft.getEventNameOfServerAlways(ft),yt=ft.getInput();yt.on(vt,function(){var t=n(this);console.log(t);p=p-1;p===0&&setTimeout(function(){for(var t,i=!0,n=0;n<y.length;n++)t=y[n].plugin,t.isInvalid(t)&&(i=!1);i===!0&&(ut=!0,e.submit());rt.removeAttr("disabled","disabled")},500)})}}}})(jQuery,window,document);
//# sourceMappingURL=jquery.server-validate.min.js.map
